---
title: "How AI Agents Do Things"
slug: "how-ai-agents-do-things"
date: "2023-12-1"
authors:
  - author: <a href="/ryan">Ryan Alyn Porter</a>
  - author: and the <a href="https://chat.openai.com/g/g-MA4ZbLQBi-assistant-alpha"><i>Anthus</i></a> GPT
tags: ["solutions", "featured"]
excerpt: You can use function-calling to bring live, dynamic information into your agent conversations.  And you can enable your agents to take action on your behalf by giving them tools they can use.  Here's how it works, with a working code example that you can run yourself.
preview_image: "./images/ai-agent-uses-tools.png"
images: ["./images/ai-agent-uses-tools.png"]
state: draft
---

import BlogImage from '../../components/blog-image';

When I wrote this in December, ChatGPT's knowledge cutoff date was months before in March.  It doesn't know about any news that happened after that.

But some AI agents can tell you about things that happened after the knowledge cutoff date.  They can somehow do web searches and look up things in databases.  So, how does that work?  How can an AI agent look up the status of an order if information about that order wasn’t included in the AI model’s pre-training?

Some AI agents can do more than look up stuff, they can do things for you.  When you ask ChatGPT to make an image with Dall-E, how does that work?  Is the AI model somehow deeply integrated with the image-generation model so that it returns images along with its text completions?

Not really.  The answer is simpler, and it's preview of a new type of software solution.

## Give tools to the AI model

<BlogImage images={props.pageContext.frontmatter.images} name="ai-agent-uses-tools.png" className="right" alt="An AI agent with a collection of tools." />

Imagine you’re having a conversation with an assistant at an airline who can type on their airline terminal at superhuman speeds to fetch the latest information to answer your questions.

This is akin to what happens when we interact with an agent based on OpenAI technology that can look up facts or draw pictures.  Imagine the assistant pausing the conversation to use a tool to look up the latest data or perform a quick calculation.  Or maybe it uses the tool to draw something, or send a message, or create an order.  Maybe it sends a message or starts some long-running process in motion.

These tools that the model can use are the "functions": A computer program that you give to the agent that it can use when necessary.  Functions are how you integrate existing systems with AI language models to create AI agents.

## How does the AI model use the tools?

But how does that work?  How does the AI model run the function for you?  If you're building an AI agent and you want to use functions, then do you upload your function code to OpenAI for them to run when the model needs to call your function, like when you upload your function code to AWS Lambda?  How do you provide it with the credentials for accessing your private information when it runs in OpenAI's cloud servers?  What programming languages can you use?  How fast or slow will it run, and how can you adjust that?

The answer to all these questions is simple and elegant: <mark>You run the function yourself.</mark>  The OpenAI model doesn't directly run the function, it just tells you to do it, and how.  It tells you the name of the function to run and it gives you the parameters to use.  You do it yourself and you report back to OpenAI once you have results.  You end up calling the API two times instead of once.  You “augment” the second API request with the results of the function call.

## A basic request and response

Let's see what it looks like, without any code.  Here's a simple request from an agent application to the OpenAI API:

<div className="blockDiagram request">
  <div className="title">
    request from application to OpenAI
  </div>

  <div className="container conversationHistory">
    <div className="title">
      conversation history
    </div>
    <table className="messages">
      <tr>
        <td className="role">system</td>
        <td className="content">You are a helpful agent for an online store.</td>
      </tr>
      <tr>
        <td className="role">user</td>
        <td className="content">Hello.</td>
      </tr>
    </table>
  </div>

</div>

The OpenAI API send a response that includes the next message in the conversation history, from the AI agent.  Those are labeled with the role "agent".

<div className="blockDiagram response">
  <div className="title">
    response from OpenAI to the application
  </div>

  <div className="container conversationHistory">
    <table className="messages">
      <tr>
        <td className="role">assistant</td>
        <td className="content">Hello, how can I help you?</td>
      </tr>
    </table>
  </div>
</div>

## Now let's give it tools

As the application, we're responsible for managing the conversation history.  OpenAI doesn't maintain any sort of session state on their side.  Every time we send the next request in a conversation to the OpenAI API, we must provide the conversation history.  We do that by taking the previous conversation history and adding the latest response from the AI, and the latest message from the user.

This time, we'll also give it a couple of functions that it could call if it decides that it should.  We add a list of those functions to the request along with the conversation history.  Each function is a description to the AI model that tells it the name of the function, what it's for, and how to call it.  Different functions require different parameters, and you use this description to tell it that when it wants to look up an order ID, it needs to provide an order ID.  Or that when it wants to create a new order, it needs to provide the customer information and the order items.

There's a structured format (JSON) for describing the functions, but let's skip the code in this simplified diagram:

<div className="blockDiagram request">
  <div className="title">
    request from application to OpenAI
  </div>

  <div className="container conversationHistory">
    <div className="title">
      conversation history
    </div>
    <table className="messages">
      <tr>
        <td className="role">system</td>
        <td className="content">You are a helpful agent for an online store.</td>
      </tr>
      <tr>
        <td className="role">user</td>
        <td className="content">Hello.</td>
      </tr>
      <tr>
        <td className="role">assistant</td>
        <td className="content">Hello, how can I help you?</td>
      </tr>
      <tr>
        <td className="role">user</td>
        <td className="content">What's the status of order 123456789?</td>
      </tr>
    </table>
  </div>

  <div className="container conversationHistory">
    <div className="title">
      functions
    </div>
    <table className="messages">
      <tr>
        <td className="role">check order status</td>
        <td className="content">Call this function with the order ID and it will give you the status of that order.</td>
      </tr>
      <tr>
        <td className="role">create order</td>
        <td className="content">Call this function with the items that the customer wants to order and the customer's information, and it will create a new order.</td>
      </tr>
    </table>
  </div>
</div>

When the OpenAI API gets that request, what's in the request is the only thing that it knows about the conversation history, or about what functions are available, or anything.

## The agent asks you to call a function

So, it looks at the situation and it concludes that the user is asking it for the status of order ID 123456789.  It looks at its list of functions available, and it sees that there's a function called "check order status" that requires an order ID.  Hey, look!  We have an order ID!  The planets are aligning!

The AI model will check on that order ID by responding like this:

<div className="blockDiagram response">
  <div className="title">
    response from OpenAI to the application
  </div>

  <div className="container conversationHistory">
    <table className="messages">
      <tr>
        <td className="role">function</td>
        <td className="content">Call the "check order status" function for order ID 123456789.</td>
      </tr>
    </table>
  </div>
</div>

As the application, it is now your job to do that thing, whatever it's called in your programming language.  Your code queries your system to get raw order details:

<pre>
<code>
orderId: 123456789
status: 046-IN-TRANSIT
lastUpdate: 1648762800000
location: OAKLAND, CA
</code>
</pre>

Great, you have some raw data but you can't show that ugly stuff to the user.

## Use the AI to describe the results

To generate an AI response to the user, you send a second API request to the OpenAI API.  It's just like before, you're sending a conversation history with the request, and that's the only way that the AI model knows anything about what's going on.  In that history, it sees that the user asked a question, it decided to call a function, and it sees the results of the function call.

<div className="blockDiagram request">
  <div className="title">
    request from application to OpenAI
  </div>

  <div className="container conversationHistory">
    <div className="title">
      conversation history
    </div>
    <table className="messages">
      <tr>
        <td className="role">system</td>
        <td className="content">You are a helpful agent for an online store.</td>
      </tr>
      <tr>
        <td className="role">user</td>
        <td className="content">Hello.</td>
      </tr>
      <tr>
        <td className="role">assistant</td>
        <td className="content">Hello, how can I help you?</td>
      </tr>
      <tr>
        <td className="role">user</td>
        <td className="content">What's the status of order 123456789?</td>
      </tr>
      <tr>
        <td className="role">assistant</td>
        <td className="content">Call the "check order status" function for order ID 123456789.</td>
      </tr>
      <tr>
        <td className="role">function</td>
        <td className="content">Name: "check order status"  Results: orderId: 123456789, status: 046-IN-TRANSIT, lastUpdate: 1648762800000, location: OAKLAND, CA</td>
      </tr>

    </table>
  </div>

  <div className="container conversationHistory">
    <div className="title">
      functions
    </div>
    <table className="messages">
      <tr>
        <td className="role">check order status</td>
        <td className="content">Call this function with the order ID and it will give you the status of that order.</td>
      </tr>
      <tr>
        <td className="role">create order</td>
        <td className="content">Call this function with the items that the customer wants to order and the customer's information, and it will create a new order.</td>
      </tr>
    </table>
  </div>
</div>

The AI model will take the value that you gave it and use that to generate the next message in the conversation:

<div className="blockDiagram response">
  <div className="title">
    response from OpenAI to the application
  </div>

  <div className="container conversationHistory">
    <table className="messages">
      <tr>
        <td className="role">assistant</td>
        <td className="content">Order ID 123456789 is in transit, in Oakland, California.</td>
      </tr>
    </table>
  </div>
</div>

## Division of responsibilities

Managing the conversation history is our prerogative as the application, which gives us an Orwellian control over the past and the present.  We can use that to insert things like the status information for an order, or proprietary facts, or anything that might be useful to the model.

We're also executing the functions, which eliminates any concerns about the complexities of deploying your code into the OpenAI API to run it.

We're doing all the real work ourselves when we use function calling, but we're using the reasoning ability of the AI model to decide what tools to use, when to use them, and how to use them.

<div class="comparisonChart">
  <div class="left-side">
    <h4>Application</h4>
    <ul style={{listStylePosition: `outside`}}>
      <li>Manage conversation history</li>
      <li>Execute functions</li>
    </ul>
  </div>
  <div class="separator"></div>
  <div class="right-side">
    <h4>AI Model</h4>
    <ul style={{listStylePosition: `outside`}}>
      <li>Generate text</li>
      <li>Decide what tools to use, when and how</li>
    </ul>
  </div>
</div>

The full application stack for an AI agent looks like this:

<div className="blockDiagram response">
  <div className="title">
    AI Agent Application Stack
  </div>

  <div className="container technologyStack">
    Large Language Model
  </div>
  <div className="container technologyStack">
    AI agent application code
  </div>
  <div className="container technologyStack">
    existing software system
  </div>
</div>

In this diagram, an existing system supports an AI agent user interface.  The AI agent code runs separately from the existing system and integrates with it through API calls or queries or whatever makes sense.  The large language model serves as a front-end to the user by generating the text for the conversation, using function calling to access the existing software system.

## See it for yourself

Go and create an OpenAI secret key and open this Colab notebook, where you can see this for yourself.

[coding in progress]

## Not just a friendly voice

To wrap it up, think of the AI agent as a super-helpful airline desk assistant, but with some extra tricks up its sleeve. It's not just there for a chat – it can quickly handle tasks like making bookings or finding out flight details. And it does all this quicker than even the fastest-typing airline staff. While this method requires an additional step, the payoff is substantial: a live connection to the real world.  AI models that can do things for you, which is the definition of an AI agent.

The artificial intelligence industry is increasingly focused on integration, since an AI agent is a lot more useful if it can do things that you care about in the systems that you already use.  One of the key ways to integrate your existing systems with the latest and greatest AI models is to give them a toolbox for accessing your system.

## We can help

We have experience integrating enterprise business systems with AI models to create AI agents that can report to you about metrics, notify you about alarms, or trigger actions in your system like creating orders or other business use cases.  We also have experience reliably operating mission-critical software features over the long term.  If you're looking for help with something like that, please get in touch.